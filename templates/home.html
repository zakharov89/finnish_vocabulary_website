{% extends "base.html" %}

{% block content %}
<h2>Welcome to the Finnish Vocabulary Website</h2>

<form method="get" action="{{ url_for('home') }}" autocomplete="off" style="margin-bottom:25px;">

    <div class="search-container">
        <input type="text" id="search-input" name="query" placeholder="Enter a word or category" value="{{ query }}">
        <ul id="suggestions" class="suggestions-list"></ul>
    </div>
    <div style="height:10px"></div>

    <div class="search-modes">
        <label>
            <input type="radio" name="mode" value="finnish" {% if mode == 'finnish' %}checked{% endif %}> Finnish Word
        </label>
        <label>
            <input type="radio" name="mode" value="translation" {% if mode == 'translation' %}checked{% endif %}> Translation
        </label>
        <label>
            <input type="radio" name="mode" value="category" {% if mode == 'category' %}checked{% endif %}> Category
        </label>
    </div>
    <div style="height:5px"></div>
    <button type="submit">Search</button>
</form>

{% if query %}
    <h3>Search Results for "{{ query }}" ({{ mode|capitalize }})</h3>

    {% if results %}
        <ul>
        {% for item in results %}
            {% if mode == 'category' %}
                <li><a href="{{ url_for('show_category', category_name=item) }}">{{ item }}</a></li>
            {% else %}
                <li><a href="{{ url_for('show_word', word_name=item) }}">{{ item }}</a></li>
            {% endif %}
        {% endfor %}
        </ul>
    {% else %}
        <p>No results found matching your search.</p>
    {% endif %}
{% endif %}


<script>
const input = document.getElementById('search-input');
const suggestionsList = document.getElementById('suggestions');

input.addEventListener('input', async function() {
    const query = this.value;
    const mode = document.querySelector('input[name="mode"]:checked').value;

    if (!query) {
        suggestionsList.innerHTML = '';
        return;
    }

    const response = await fetch(`/autocomplete?query=${encodeURIComponent(query)}&mode=${mode}`);
    const suggestions = await response.json();

    suggestionsList.innerHTML = '';
    suggestions.forEach(item => {
        const li = document.createElement('li');
        li.textContent = item;
        li.classList.add('suggestion-item');
        li.addEventListener('click', () => {
            suggestionsList.innerHTML = '';
            if (mode === 'category') {
                window.location.href = `/categories/${encodeURIComponent(item)}`;
            } else {
                window.location.href = `/word/${encodeURIComponent(item)}`;
            }
        });

        suggestionsList.appendChild(li);
    });
});

// Close suggestions when clicking outside
document.addEventListener('click', function(e) {
    if (!input.contains(e.target)) {
        suggestionsList.innerHTML = '';
    }
});
</script>

{% endblock %}
