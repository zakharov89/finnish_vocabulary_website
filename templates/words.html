{% extends "base.html" %}
{% block content %}

<div class="words-container">

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash {{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- LEVEL DROPDOWN + APPLY BUTTON -->
    <form id="levels-form" method="POST" class="level-dropdown-form">
        <div class="level-dropdown-wrapper" style="display: inline-flex; align-items: center; gap: 6px;">
            <div class="level-dropdown">
                <button type="button" class="dropdown-toggle">Select Levels â–¼</button>
                <div class="dropdown-content">
                    <!-- Select/Deselect All -->
                    <label class="level-pill select-all-pill" onclick="toggleAllLevels(this)">
                        Select/Deselect All
                    </label>

                    <!-- Levels except 0 -->
                    {% for level in levels %}
                        {% if level.id != 0 %}
                        <label class="level-pill">
                            <input type="checkbox" name="levels" value="{{ level.id }}"
                                   {% if level.id in selected_levels %}checked{% endif %}>
                            {{ level.name }}
                        </label>
                        {% endif %}
                    {% endfor %}

                    <!-- No Level at bottom -->
                    {% for level in levels %}
                        {% if level.id == 0 %}
                        <label class="level-pill no-level-pill">
                            <input type="checkbox" name="levels" value="{{ level.id }}"
                                   {% if level.id in selected_levels %}checked{% endif %}>
                            No Level
                        </label>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>

            <!-- Apply button outside, right of dropdown -->
            <button type="submit" form="levels-form" class="apply-button">Apply</button>
        </div>
    </form>

    {% if selected_levels %}
        <p class="filter-summary">
            Showing words for levels: 
            {{ levels | selectattr('id','in',selected_levels) | map(attribute='name') | join(', ') }}
        </p>
    {% endif %}

    {% if words %}
    <div class="words-table">
        {% for w in words %}
        <div class="word-card">
            <a class="word-title" href="{{ url_for('show_word', word_name=w.word) }}" target="_blank">{{ w.word }}</a>
            <div class="translations">
                {% for t in w.translations %}
                    <span class="translation-badge">{{ t }}</span>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
        <p class="no-words">No words found for the selected level(s).</p>
    {% endif %}

</div>

<style>
.words-container { max-width: 900px; margin: 0 auto; padding: 15px; text-align: center; font-family: 'Segoe UI', sans-serif; }

/* Dropdown */
.level-dropdown { position: relative; display: inline-block; }
.dropdown-toggle { background-color: #e3f2fd; color: #1a237e; padding: 8px 14px; font-size: 0.95rem; border: 1px solid #1a237e; border-radius: 8px; cursor: pointer; min-width: 140px; transition: 0.2s; }
.dropdown-toggle:hover { background-color: #bbdefb; }
.dropdown-content { display: none; position: absolute; background-color: #fff; min-width: 180px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border-radius: 8px; padding: 10px; z-index: 100; max-height: 300px; overflow-y: auto; flex-direction: column; }
.dropdown-content.show { display: flex !important; }

/* Pills */
.level-pill { display: flex; align-items: center; margin: 5px 0; padding: 6px 10px; border-radius: 25px; background-color: #90caf9; color: #1a237e; font-size: 0.9rem; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 2px 4px rgba(0,0,0,0.1); user-select: none; }
.level-pill:hover { background-color: #64b5f6; transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
.level-pill input { margin-right: 8px; }
.no-level-pill { background-color: #cfd8dc; color: #37474f; }
.select-all-pill { background-color: #ffe082; color: #424242; font-weight: bold; }

/* Apply button (smaller, compact) */
.apply-button {
    padding: 5px 12px;
    border-radius: 20px;
    border: none;
    background: linear-gradient(90deg, #64b5f6, #42a5f5);
    color: white;
    font-weight: 500;
    font-size: 0.85rem;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.15);
    transition: all 0.2s ease;
}
.apply-button:hover {
    background: linear-gradient(90deg, #42a5f5, #1e88e5);
    transform: translateY(-1px);
    box-shadow: 0 3px 6px rgba(0,0,0,0.2);
}

/* Filter summary */
.filter-summary { font-style: italic; color: #555; margin-bottom: 15px; }

/* Word cards */
.words-table { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; margin-top: 20px; }
.word-card { background-color: #f1f8e9; padding: 15px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); transition: 0.2s; display: flex; flex-direction: column; align-items: flex-start; }
.word-card:hover { transform: translateY(-2px); box-shadow: 0 5px 10px rgba(0,0,0,0.15); }
.word-title { font-weight: 600; font-size: 1.05rem; margin-bottom: 8px; color: #1a237e; text-decoration: none; }
.word-title:hover { text-decoration: underline; }
.translations { display: flex; flex-wrap: wrap; gap: 5px; }
.translation-badge { background-color: #64b5f6; color: #fff; padding: 3px 8px; border-radius: 12px; font-size: 0.85rem; }
.no-words { margin-top: 30px; color: #777; font-style: italic; }

/* Responsive */
@media (max-width: 600px) {
    .level-dropdown-wrapper { flex-direction: column; gap: 6px; align-items: stretch; }
    .dropdown-toggle { width: 100%; }
    .apply-button { width: 100%; }
    .words-table { grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); }
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const toggle = document.querySelector(".dropdown-toggle");
    const content = document.querySelector(".dropdown-content");

    toggle.addEventListener("click", () => content.classList.toggle("show"));
    window.addEventListener("click", e => {
        if (!toggle.contains(e.target) && !content.contains(e.target)) {
            content.classList.remove("show");
        }
    });
});

// Select/Deselect All function
function toggleAllLevels(label) {
    const form = label.closest("form");
    const checkboxes = form.querySelectorAll('input[name="levels"]');
    const allChecked = Array.from(checkboxes).every(cb => cb.checked);
    checkboxes.forEach(cb => cb.checked = !allChecked);
}
</script>

{% endblock %}
