{% extends "base.html" %}
{% block content %}

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="flash {{ category }}">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<div class="container mt-5">
    <h2>Edit Word: {{ word.word }}</h2>

    <!-- Update Word Form -->
    <form method="POST" class="mb-3">
        <div class="mb-3">
            <label for="word" class="form-label">Word</label>
            <input type="text" class="admin-input" name="word" id="word" value="{{ word.word }}" required>
        </div>

        <div class="mb-3">
            <label for="pos_id" class="form-label">Part of Speech</label>
            <select class="admin-select" name="pos_id" id="pos_id" required>
                {% for pos in pos_list %}
                    <option value="{{ pos.id }}" {% if word.pos_id == pos.id %}selected{% endif %}>{{ pos.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div style="height:5px"></div>
        <button type="submit" class="admin-btn">Update Word</button>

        
    </form>
            <!-- Delete Word -->
        <form method="POST" action="{{ url_for('admin_delete_word', word_id=word.id) }}" 
            onsubmit="return confirm('Are you sure you want to delete this word and all its meanings?');" class="mb-4">
            <button type="submit" class="admin-btn delete-btn">Delete Word</button>
        </form>
    
    <hr>
    <h3>Meanings</h3>

    <div class="list-group">
        {% for meaning in meanings %}
        <div class="meaning-block">
          
            <strong>Translations:</strong> {{ meaning.translations | join(", ") }}
            <br>
            <strong>Examples:</strong>
            <ul class="examples">
                {% for ex, ex_tr in meaning.examples %}
                    <li>{{ ex }} {% if ex_tr %} â€” {{ ex_tr }}{% endif %}</li>
                {% endfor %}
            </ul>
            <strong>Finnish definition:</strong> {{ meaning.definition}}
            <br>
            <strong>Notes:</strong> {{ meaning.notes}}
            <div class="mt-2 d-flex gap-2">
                <a href="{{ url_for('admin_edit_meaning', meaning_id=meaning.id) }}" 
                   class="admin-btn btn-warning">Edit Meaning</a>

                {% if meanings|length > 1 and loop.last %}
                <form method="POST" action="{{ url_for('admin_delete_meaning', meaning_id=meaning.id) }}" 
                      onsubmit="return confirm('Are you sure you want to delete this meaning?');" style="display:inline-block;">
                    <button type="submit" class="admin-btn delete-btn">Delete Meaning</button>
                </form>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <!-- Add Meaning / Back to Dashboard -->
    
    <p>
    <a href="{{ url_for('admin_add_meaning', word_id=word.id) }}" class="admin-btn">Add Meaning</a>
    </p>

    <p>
    <a href="{{ url_for('admin_dashboard') }}" class="admin-btn-small">Back to Dashboard</a>
    </p>



</div>
{% endblock %}
