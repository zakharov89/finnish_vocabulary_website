{% extends "base.html" %}

{% block content %}
<h2>Edit Word: "{{ word['word'] }}"</h2>

<div class="admin-add-word-container">
<form method="post" class="admin-add-word-form">

    <p>
        <label>Word:</label><br>
        <input type="text" name="word" value="{{ word['word'] }}" required class="admin-input" placeholder="Enter word">
    </p>

    <p>
        <label>Part of Speech:</label><br>
        <select name="pos_id" required class="admin-select">
            {% for pos in pos_list %}
            <option value="{{ pos['id'] }}" {% if pos['id'] == word['pos_id'] %}selected{% endif %}>{{ pos['name'] }}</option>
            {% endfor %}
        </select>
    </p>

    <p>
        <label>Category (optional):</label><br>
        <input type="text" name="category_name" class="admin-input" id="category-input" placeholder="Type to search category..." value="{{ word['category_name'] or '' }}">
        <div id="category-suggestions" class="suggestions-list"></div>
    </p>

    <hr>
    <h3>Meanings</h3>
    <div id="meanings-container" class="meanings-section">
        {% for meaning in meanings %}
        <div class="meaning-block" data-meaning-number="{{ meaning['meaning_number'] }}">
            <input type="hidden" name="meaning_number[]" value="{{ meaning['meaning_number'] }}">

            <p>Translations:</p>
            <div id="translations-{{ meaning['meaning_number'] }}" class="translations-group">
                {% for t in meaning['translations'] %}
                <input type="text" name="translations_{{ meaning['meaning_number'] }}[]" value="{{ t }}" class="admin-input" placeholder="Enter translation"><br>
                {% endfor %}
            </div>
            <button type="button" class="admin-btn" onclick="addTranslation({{ meaning['meaning_number'] }})">+ Add Translation</button>

            <p>Examples (optional):</p>
            <div id="examples-{{ meaning['meaning_number'] }}" class="examples-group">
                {% for ex, ex_trans in meaning['examples'] %}
                <div class="example-pair">
                    <input type="text" name="examples_{{ meaning['meaning_number'] }}[]" value="{{ ex }}" class="admin-input" placeholder="Enter example">
                    <input type="text" name="examples_trans_{{ meaning['meaning_number'] }}[]" value="{{ ex_trans or '' }}" class="admin-input" placeholder="Enter example translation">
                </div>
                {% endfor %}
            </div>
            <button type="button" class="admin-btn" onclick="addExample({{ meaning['meaning_number'] }})">+ Add Example</button>

            <p>Finnish definition (optional):</p>
            <input type="text" name="definition_{{ meaning['meaning_number'] }}" class="admin-input" 
                placeholder="Enter Finnish definition" value="{{ meaning['definition'] or '' }}">


            <p>Notes (optional):</p>
            <input type="text" name="meaning_notes[]" class="admin-input" placeholder="Enter notes" value="{{ meaning['notes'] or '' }}">
        </div>
        {% endfor %}
    </div>

    <button type="button" onclick="addMeaning()" class="admin-btn">+ Add Meaning</button>

    <p>
        <button type="submit" class="admin-btn">Update Word</button>
    </p>

</form>
</div>

<hr style="margin-top:25px; margin-bottom:15px;">
<form method="post" action="{{ url_for('admin_delete_word', word_id=word['id']) }}" 
      onsubmit="return confirm('Are you sure you want to delete this word?');">
    <button type="submit" class="admin-btn delete-btn">Delete Word</button>
</form>

<p>
    <a href="{{ url_for('admin_dashboard') }}" class="admin-btn-small">Back to Dashboard</a>
</p>

<script>
(function(){
    let meaningCount = {{ meanings|length if meanings else 1 }};

    function addTranslation(num) {
        const container = document.getElementById(`translations-${num}`);
        const wrapper = document.createElement('div');
        wrapper.className = 'translation-item';
        const input = document.createElement('input');
        input.type = 'text';
        input.name = `translations_${num}[]`;
        input.className = 'admin-input';
        input.placeholder = 'Enter translation';
        wrapper.appendChild(input);
        container.appendChild(wrapper);
    }

    function addExample(num) {
        const container = document.getElementById(`examples-${num}`);
        const wrapper = document.createElement('div');
        wrapper.className = 'example-pair';
        const text = document.createElement('input');
        text.type = 'text';
        text.name = `examples_${num}[]`;
        text.className = 'admin-input';
        text.placeholder = 'Enter example';
        const trans = document.createElement('input');
        trans.type = 'text';
        trans.name = `examples_trans_${num}[]`;
        trans.className = 'admin-input';
        trans.placeholder = 'Enter example translation';
        wrapper.appendChild(text);
        wrapper.appendChild(trans);
        container.appendChild(wrapper);
    }

    window.addMeaning = function() {
        meaningCount++;
        const container = document.getElementById('meanings-container');
        const div = document.createElement('div');
        div.className = 'meaning-block';
        div.dataset.meaningNumber = meaningCount;
        div.innerHTML = `
            <input type="hidden" name="meaning_number[]" value="${meaningCount}">
            <p>Translations:</p>
            <div id="translations-${meaningCount}" class="translations-group">
                <input type="text" name="translations_${meaningCount}[]" class="admin-input" placeholder="Enter translation"><br>
            </div>
            <button type="button" class="admin-btn" onclick="addTranslation(${meaningCount})">+ Add Translation</button>
            <p>Examples (optional):</p>
            <div id="examples-${meaningCount}" class="examples-group">
                <div class="example-pair">
                    <input type="text" name="examples_${meaningCount}[]" class="admin-input" placeholder="Enter example">
                    <input type="text" name="examples_trans_${meaningCount}[]" class="admin-input" placeholder="Enter example translation">
                </div>
            </div>
            <button type="button" class="admin-btn" onclick="addExample(${meaningCount})">+ Add Example</button>
            <p>Finnish definition (optional):</p>
            <input type="text" name="definition_${meaningCount}" class="admin-input" placeholder="Enter Finnish definition">
            <p>Notes (optional): <input type="text" name="meaning_notes[]" class="admin-input" placeholder="Enter notes"></p>
        `;
        container.appendChild(div);
    }

    window.addTranslation = addTranslation;
    window.addExample = addExample;
})();
</script>
{% endblock %}
