<form id="levels-form" method="POST" class="level-pill-form">
    <div class="level-pill-container" style="display:flex; flex-wrap:wrap; gap:10px; margin-bottom:12px;">

        <!-- Dynamic Select/Deselect All -->
        <label id="select-all-pill" class="level-pill select-all-pill" onclick="toggleAllLevels(this)">
            Select All
        </label>

        <!-- All levels as pills -->
        {% for level in levels %}
        <label class="level-pill {% if level.id == 0 %}no-level-pill{% endif %}"
               data-level-id="{{ level.id }}"
               onclick="toggleLevel(this)">
            {{ level.name }}
        </label>
        {% endfor %}
    </div>
</form>

<style>
.level-pill {
    display: inline-flex;
    align-items: center;
    margin: 5px 3px;
    padding: 6px 14px;
    border-radius: 25px;
    background: linear-gradient(145deg, #e0f7fa, #b2ebf2); /* soft cyan */
    color: #006064;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease, transform 0.15s;
    box-shadow: 0 2px 4px rgba(0,0,0,0.08);
}

.level-pill:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.level-pill.selected {
    background: linear-gradient(145deg, #00acc1, #00838f); /* stronger cyan */
    color: #fff;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.no-level-pill {
    background: linear-gradient(145deg, #b0bec5, #90a4ae);
    color: #fff;
}

.select-all-pill {
    background: linear-gradient(145deg, #ffb74d, #ff8a65);
    color: #fff;
    font-weight: bold;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const selectedLevels = {{ selected_levels | tojson }};
    const pills = document.querySelectorAll('.level-pill[data-level-id]');
    const selectAllPill = document.getElementById('select-all-pill');

    // Initialize selected pills
    pills.forEach(pill => {
        const id = parseInt(pill.dataset.levelId);
        if(selectedLevels.includes(id)) pill.classList.add('selected');
    });

    updateSelectAllLabel();

    function updateSelectAllLabel() {
        const allSelected = Array.from(pills).every(p => p.classList.contains('selected'));
        selectAllPill.textContent = allSelected ? 'Deselect All' : 'Select All';
    }

    window.toggleLevel = function(pill) {
        pill.classList.toggle('selected');
        updateSelectAllLabel();
        updateHiddenInputs();
        document.getElementById('levels-form').submit();
    }

    window.toggleAllLevels = function() {
        const allSelected = Array.from(pills).every(p => p.classList.contains('selected'));
        pills.forEach(p => p.classList.toggle('selected', !allSelected));
        updateSelectAllLabel();
        updateHiddenInputs();
        document.getElementById('levels-form').submit();
    }

    function updateHiddenInputs() {
        const form = document.getElementById('levels-form');
        form.querySelectorAll('input[name="levels"]').forEach(el => el.remove());
        document.querySelectorAll('.level-pill.selected[data-level-id]').forEach(p => {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'levels';
            input.value = p.dataset.levelId;
            form.appendChild(input);
        });
    }
});
</script>
